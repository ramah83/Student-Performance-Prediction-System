{% extends 'base.html' %}

{% block title %}RAM - Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø¯Ø±Ø¬Ø§Øª{% endblock %}

{% block content %}
<div class="col-12">
    <div class="main-content">
        <!-- Modern 3D Page Header -->
        <div class="page-header-3d fade-in-up">
            <h1>Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
            <p>Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ Ù„Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù„ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</p>
        </div>
        
        <div class="row">
            <!-- Left Column: Input Form and Results -->
            <div class="col-md-6">
                <!-- 3D Input Form -->
                <div class="form-3d fade-in-left mb-4">
                    <div class="text-center mb-4">
                        <div class="stats-icon-3d" style="font-size: 1.8rem; margin-bottom: 15px;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</div>
                        <h4 style="color: var(--text-primary);">Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h4>
                    </div>
                    <form id="predictionForm">
                            {% csrf_token %}
                            <div class="mb-4">
                                <label class="form-label-3d">Ø§Ù„Ø¬Ù†Ø³</label>
                                <select class="form-control-3d" name="gender" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
                                    <option value="male">Ø°ÙƒØ± male</option>
                                    <option value="female">Ø£Ù†Ø«Ù‰ female</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="form-label-3d">Ø§Ù„Ø¹Ø±Ù‚/Ø§Ù„Ø¥Ø«Ù†ÙŠØ©</label>
                                <select class="form-control-3d" name="race_ethnicity" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</option>
                                    <option value="group A">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© A</option>
                                    <option value="group B">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© B</option>
                                    <option value="group C">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© C</option>
                                    <option value="group D">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© D</option>
                                    <option value="group E">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© E</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="form-label-3d">Ù…Ø³ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ… Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†</label>
                                <select class="form-control-3d" name="parental_education" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</option>
                                    <option value="some high school">Ø¨Ø¹Ø¶ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Some high school</option>
                                    <option value="high school">Ø«Ø§Ù†ÙˆÙŠØ© Ø¹Ø§Ù…Ø© High school</option>
                                    <option value="some college">Ø¨Ø¹Ø¶ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Some college</option>
                                    <option value="associate's degree">Ø¯Ø±Ø¬Ø© Ù…Ø´Ø§Ø±Ùƒ Associate's degree</option>
                                    <option value="bachelor's degree">Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³ Bachelor's degree</option>
                                    <option value="master's degree">Ù…Ø§Ø¬Ø³ØªÙŠØ± Master's degree</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="form-label-3d">Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¬Ø¨Ø©</label>
                                <select class="form-control-3d" name="lunch" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                                    <option value="standard">Ø¹Ø§Ø¯ÙŠØ© Standard</option>
                                    <option value="free/reduced">Ù…Ø¬Ø§Ù†ÙŠØ©/Ù…Ø®ÙØ¶Ø© Free</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="form-label-3d">Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
                                <select class="form-control-3d" name="test_preparation" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
                                    <option value="none">Ù„Ù… ÙŠØ­Ø¶Ø± None</option>
                                    <option value="completed">Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¯ÙˆØ±Ø© Completed</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn-3d w-100 micro-bounce" style="padding: 15px; font-size: 1.1rem;">
                                ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                            </button>
                        </form>
                </div>
                
                <!-- 3D Results Section -->
                <div class="card-3d fade-in-up">
                    <div class="text-center mb-4">
                        <div class="stats-icon-3d" style="font-size: 1.8rem; margin-bottom: 15px;">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
                        <h4 style="color: var(--text-primary);">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ†Ø¨Ø¤</h4>
                    </div>
                    <div id="predictionResults" class="text-center">
                        <div class="py-4">
                            <div class="stats-icon-3d" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.5;">Ø§Ù„ØªØ­Ù„ÙŠÙ„</div>
                            <p style="color: var(--text-secondary);">Ù‚Ù… Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø¯Ø±Ø¬Ø§Øª" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>
                        </div>
                    </div>
                </div>
                
                <!-- 3D Prediction Chart -->
                <div class="chart-container-3d mt-4 fade-in-up">
                    <div class="text-center mb-3">
                        <h5 style="color: var(--text-primary);">
                            <i class="fas fa-chart-area" style="margin-left: 10px; color: #667eea;"></i>
                            Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù†ØªØ§Ø¦Ø¬
                        </h5>
                    </div>
                    <div id="predictionChart" style="height: 300px;"></div>
                </div>
            </div>
            
            <!-- Right Column: Model Training and Performance -->
            <div class="col-md-6">
                <!-- Model Training -->
                <div class="card-3d fade-in-right mb-4">
                    <div class="text-center mb-4">
                        <div class="stats-icon-3d" style="font-size: 1.8rem; margin-bottom: 15px;">ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</div>
                        <h4 style="color: var(--text-primary);">Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù„ÙŠ</h4>
                    </div>
                    <div class="text-center">
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">Ù‚Ù… Ø¨ØªØ¯Ø±ÙŠØ¨ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„ØªÙ†Ø¨Ø¤</p>
                        <button id="trainModel" class="btn-3d w-100 micro-bounce" style="padding: 15px; font-size: 1.1rem;">
                            ğŸš€ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                        </button>
                        <div id="trainingStatus" class="mt-3"></div>
                        <div id="modelStatus" class="mt-2"></div>
                    </div>
                </div>
                
                <!-- Model Performance -->
                <div class="card-3d fade-in-up">
                    <div class="text-center mb-4">
                        <div class="stats-icon-3d" style="font-size: 1.8rem; margin-bottom: 15px;">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</div>
                        <h4 style="color: var(--text-primary);">Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø£Ø¯Ø§Ø¡</h4>
                    </div>
                    <div class="text-center mb-3">
                        <button id="showDetailedPerformance" class="btn-3d micro-bounce">
                            <i class="fas fa-chart-pie me-2"></i>ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„
                        </button>
                    </div>
                    <div id="modelPerformance">
                        <div class="text-center py-4">
                            <div class="stats-icon-3d" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.5;">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
                            <p style="color: var(--text-secondary);">Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø¨Ø¤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Information Section -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>â„¹ï¸ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <h6>1. ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</h6>
                                <p>ÙŠØªÙ… ØªØ¯Ø±ÙŠØ¨ Ù†Ù…Ø§Ø°Ø¬ Random Forest Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©</p>
                            </div>
                            <div class="col-md-4">
                                <h6>2. Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h6>
                                <p>Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨</p>
                            </div>
                            <div class="col-md-4">
                                <h6>3. Ø§Ù„ØªÙ†Ø¨Ø¤</h6>
                                <p>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª ÙˆØ§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø©</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Detailed Performance Modal -->
<div class="modal fade" id="performanceModal" tabindex="-1" aria-labelledby="performanceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="performanceModalLabel">
                    <i class="fas fa-chart-pie me-2"></i>ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙØµÙ„
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="detailedPerformanceContent">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...</span>
                        </div>
                        <p class="mt-3 text-muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙØµÙ„Ø©...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                <button type="button" class="btn btn-primary" id="downloadReport">
                    <i class="fas fa-download me-1"></i>ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // Check if models are trained on page load
    checkModelStatus();
    
    // Train Model
    $('#trainModel').click(function() {
        const btn = $(this);
        btn.prop('disabled', true).html('â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨...');
        $('#trainingStatus').html(`
            <div class="alert alert-info">
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    <span>Ø¬Ø§Ø±ÙŠ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬... Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ù‡Ø°Ø§ Ø¨Ø¶Ø¹ Ø¯Ù‚Ø§Ø¦Ù‚</span>
                </div>
            </div>
        `);
        
        $.ajax({
            url: '/api/prediction/train/',
            method: 'POST',
            headers: {
                'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val()
            },
            timeout: 300000, // 5 minutes timeout
            success: function(data) {
                $('#trainingStatus').html(`
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>ØªÙ… ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­!</strong>
                        <br><small>Ø¯Ù‚Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬: Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª ${(data.scores['math score'] * 100).toFixed(1)}%ØŒ 
                        Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ${(data.scores['reading score'] * 100).toFixed(1)}%ØŒ 
                        Ø§Ù„ÙƒØªØ§Ø¨Ø© ${(data.scores['writing score'] * 100).toFixed(1)}%</small>
                    </div>
                `);
                btn.prop('disabled', false).html('ğŸš€ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                setTimeout(function() {
                    checkModelStatus();
                }, 1000);
            },
            error: function(xhr, status, error) {
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨';
                
                if (xhr.responseJSON) {
                    errorMessage = xhr.responseJSON.error || xhr.responseJSON.message || errorMessage;
                } else if (status === 'timeout') {
                    errorMessage = 'Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ - ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                }
                
                $('#trainingStatus').html(`
                    <div class="alert alert-danger">
                        <i class="fas fa-times-circle me-2"></i>
                        <strong>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨:</strong> ${errorMessage}
                    </div>
                `);
                btn.prop('disabled', false).html('ğŸš€ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬');
            }
        });
    });
    
    // Prediction Form
    $('#predictionForm').submit(function(e) {
        e.preventDefault();
        
        // Show loading state
        $('#predictionResults').html(`
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†Ø¨Ø¤...</span>
                </div>
                <p class="mt-2 text-muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªÙ†Ø¨Ø¤...</p>
            </div>
        `);
        
        const formData = {
            gender: $('[name=gender]').val(),
            race_ethnicity: $('[name=race_ethnicity]').val(),
            parental_education: $('[name=parental_education]').val(),
            lunch: $('[name=lunch]').val(),
            test_preparation: $('[name=test_preparation]').val()
        };
        
        // Validate form data
        const requiredFields = {
            'gender': 'Ø§Ù„Ø¬Ù†Ø³',
            'race_ethnicity': 'Ø§Ù„Ø¹Ø±Ù‚/Ø§Ù„Ø¥Ø«Ù†ÙŠØ©', 
            'parental_education': 'Ù…Ø³ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ… Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†',
            'lunch': 'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¬Ø¨Ø©',
            'test_preparation': 'Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±'
        };
        
        let missingFields = [];
        for (let key in formData) {
            if (!formData[key]) {
                missingFields.push(requiredFields[key]);
            }
        }
        
        if (missingFields.length > 0) {
            $('#predictionResults').html(`
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ©: ${missingFields.join(', ')}
                </div>
            `);
            return;
        }
        
        console.log('Form data being sent:', formData);
        
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API Ø§Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        $.ajax({
            url: '/api/prediction/predict/',
            method: 'POST',
            headers: {
                'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val(),
                'Content-Type': 'application/json'
            },
            data: JSON.stringify(formData),
            success: function(response) {
                if (response.success && response.predictions) {
                    const predictions = response.predictions;
                    
                    // Display comprehensive prediction results
                    $('#predictionResults').html(`
                        <div class="prediction-success">
                            <div class="row mb-4">
                                <div class="col-4">
                                    <div class="stats-card-3d fade-in-up">
                                        <div class="stats-number-3d" style="color: #B85C57;">${predictions.math_score}</div>
                                        <div class="stats-label-3d">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="stats-card-3d fade-in-up" style="animation-delay: 0.1s;">
                                        <div class="stats-number-3d" style="color: #28a745;">${predictions.reading_score}</div>
                                        <div class="stats-label-3d">Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="stats-card-3d fade-in-up" style="animation-delay: 0.2s;">
                                        <div class="stats-number-3d" style="color: #ffc107;">${predictions.writing_score}</div>
                                        <div class="stats-label-3d">Ø§Ù„ÙƒØªØ§Ø¨Ø©</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Performance Summary -->
                            <div class="row mb-3">
                                <div class="col-12">
                                    <div class="alert alert-info" style="background: linear-gradient(135deg, ${predictions.performance_color}22, ${predictions.performance_color}11); border: 1px solid ${predictions.performance_color};">
                                        <h6 style="color: ${predictions.performance_color}; margin-bottom: 10px;">
                                            <i class="fas fa-chart-line me-2"></i>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…
                                        </h6>
                                        <p style="margin-bottom: 8px;"><strong>Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</strong> ${predictions.performance_level}</p>
                                        <p style="margin-bottom: 8px;"><strong>Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ù…:</strong> ${predictions.average_score}/100</p>
                                        <p style="margin-bottom: 8px;"><strong>Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ù…ÙˆØ§Ø¯:</strong> ${predictions.strongest_subject}</p>
                                        <p style="margin-bottom: 0;"><strong>ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†:</strong> ${predictions.weakest_subject}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Recommendations -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="alert alert-success">
                                        <h6><i class="fas fa-lightbulb me-2"></i>ØªÙˆØµÙŠØ§Øª Ù„Ù„ØªØ­Ø³ÙŠÙ†</h6>
                                        <ul style="margin-bottom: 0; padding-left: 20px;">
                                            ${predictions.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `);
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
                    createPredictionChart(predictions);
                    
                    // Ø¹Ø±Ø¶ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
                    if (response.model_performance) {
                        displayModelPerformance(response.model_performance);
                    }
                    
                } else {
                    $('#predictionResults').html(`
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†Ø¨Ø¤: ${response.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                        </div>
                    `);
                }
            },
            error: function(xhr, status, error) {
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…';
                
                console.log('Prediction error:', xhr.responseJSON, status, error);
                
                if (xhr.responseJSON) {
                    if (xhr.responseJSON.action_required === 'TRAIN_MODEL_FIRST') {
                        errorMessage = `
                            <div class="alert alert-warning">
                                <h6><i class="fas fa-exclamation-triangle me-2"></i>ÙŠØ¬Ø¨ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£ÙˆÙ„Ø§Ù‹</h6>
                                <p>${xhr.responseJSON.message}</p>
                                <button class="btn btn-primary btn-sm" onclick="$('#trainModel').click()">
                                    <i class="fas fa-play me-1"></i>Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø¢Ù†
                                </button>
                            </div>
                        `;
                    } else if (xhr.responseJSON.validation_errors) {
                        errorMessage = `
                            <div class="alert alert-danger">
                                <h6><i class="fas fa-times-circle me-2"></i>Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©</h6>
                                <ul style="margin-bottom: 0;">
                                    ${xhr.responseJSON.validation_errors.map(err => `<li>${err}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                        
                        // Show available options if provided
                        if (xhr.responseJSON.available_options) {
                            const options = xhr.responseJSON.available_options;
                            errorMessage += `
                                <div class="alert alert-info mt-2">
                                    <h6>Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…ØªØ§Ø­Ø©:</h6>
                                    <small>
                                        <strong>Ø§Ù„Ø¬Ù†Ø³:</strong> ${options.gender ? options.gender.join(', ') : 'ØºÙŠØ± Ù…ØªØ§Ø­'}<br>
                                        <strong>Ø§Ù„Ø¹Ø±Ù‚:</strong> ${options.race_ethnicity ? options.race_ethnicity.join(', ') : 'ØºÙŠØ± Ù…ØªØ§Ø­'}<br>
                                        <strong>Ø§Ù„ØªØ¹Ù„ÙŠÙ…:</strong> ${options.parental_education ? options.parental_education.join(', ') : 'ØºÙŠØ± Ù…ØªØ§Ø­'}<br>
                                        <strong>Ø§Ù„ÙˆØ¬Ø¨Ø©:</strong> ${options.lunch ? options.lunch.join(', ') : 'ØºÙŠØ± Ù…ØªØ§Ø­'}<br>
                                        <strong>Ø§Ù„ØªØ­Ø¶ÙŠØ±:</strong> ${options.test_preparation ? options.test_preparation.join(', ') : 'ØºÙŠØ± Ù…ØªØ§Ø­'}
                                    </small>
                                </div>
                            `;
                        }
                    } else {
                        errorMessage = `
                            <div class="alert alert-danger">
                                <i class="fas fa-times-circle me-2"></i>
                                ${xhr.responseJSON.error || xhr.responseJSON.message || errorMessage}
                            </div>
                        `;
                    }
                } else if (status === 'timeout') {
                    errorMessage = `
                        <div class="alert alert-warning">
                            <i class="fas fa-clock me-2"></i>
                            Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© - ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                        </div>
                    `;
                }
                
                $('#predictionResults').html(errorMessage);
            }
        });

    });
    
    // Show Detailed Performance Report
    $('#showDetailedPerformance').click(function() {
        $('#performanceModal').modal('show');
        loadDetailedPerformance();
    });
    
    // Download Report Handler
    $('#downloadReport').click(function() {
        const btn = $(this);
        const originalText = btn.html();
        
        btn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-1"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...');
        
        // Create a temporary link to download the PDF
        const link = document.createElement('a');
        link.href = '/api/prediction/download-report/';
        link.download = 'performance_report.pdf';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Reset button after a short delay
        setTimeout(() => {
            btn.prop('disabled', false).html(originalText);
        }, 2000);
    });
    
    // Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
    function createPredictionChart(predictions) {
        const trace = {
            x: ['Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©', 'Ø§Ù„ÙƒØªØ§Ø¨Ø©'],
            y: [predictions.math_score, predictions.reading_score, predictions.writing_score],
            type: 'bar',
            marker: {
                color: ['#B85C57', '#28a745', '#ffc107'],
                line: {
                    color: '#FFFFFF',
                    width: 4
                },
                opacity: 0.95
            },
            text: [predictions.math_score.toFixed(1), predictions.reading_score.toFixed(1), predictions.writing_score.toFixed(1)],
            textposition: 'auto',
            textfont: {
                color: 'white',
                size: 16,
                family: 'Cairo',
                weight: 'bold'
            },
            hovertemplate: '<b>%{x}</b><br>Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: %{y:.1f}<br><extra></extra>'
        };
        
        const layout = {
            title: {
                text: 'Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨',
                font: { family: 'Cairo', size: 18, color: '#2C2C2C', weight: 'bold' },
                x: 0.5
            },
            yaxis: { 
                title: { text: 'Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©', font: { family: 'Cairo', size: 12 } },
                range: [0, 100],
                gridcolor: '#F5F1ED',
                gridwidth: 1,
                font: { family: 'Cairo', size: 10 }
            },
            xaxis: {
                font: { family: 'Cairo', size: 10 },
                tickangle: 0
            },
            plot_bgcolor: '#FFFFFF',
            paper_bgcolor: '#FFFFFF',
            margin: { t: 50, b: 40, l: 50, r: 40 },
            showlegend: false,
            hovermode: 'x unified'
        };
        
        try {
            Plotly.newPlot('predictionChart', [trace], layout, {
                responsive: true,
                displayModeBar: false
            });
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ:', error);
            $('#predictionChart').html(`
                <div class="alert alert-info text-center">
                    <i class="fas fa-chart-bar me-2"></i>
                    <strong>Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ØºÙŠØ± Ù…ØªØ§Ø­</strong><br>
                    <small>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹Ø±ÙˆØ¶Ø© Ø£Ø¹Ù„Ø§Ù‡</small>
                </div>
            `);
        }
    }
    
    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    function displayModelPerformance(performance) {
        $('#modelPerformance').html(`
            <div class="row">
                <div class="col-md-12 mb-3">
                    <div class="performance-card-3d">
                        <div class="performance-header-3d">
                            <i class="fas fa-brain text-success me-2"></i>
                            <h6 style="color: var(--text-primary);">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø¯Ø±Ø¨Ø©</h6>
                        </div>
                        <div class="performance-metrics-3d">
                            <div class="metric-3d">
                                <span class="metric-label-3d">Ø¯Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª:</span>
                                <span class="metric-value-3d">${(performance.math_r2 * 100).toFixed(1)}%</span>
                            </div>
                            <div class="metric-3d">
                                <span class="metric-label-3d">Ø¯Ù‚Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©:</span>
                                <span class="metric-value-3d">${(performance.reading_r2 * 100).toFixed(1)}%</span>
                            </div>
                            <div class="metric-3d">
                                <span class="metric-label-3d">Ø¯Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø©:</span>
                                <span class="metric-value-3d">${(performance.writing_r2 * 100).toFixed(1)}%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `);
    }
    
    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ (Ø§Ø­ØªÙŠØ§Ø·ÙŠ)
    function displayMockPerformance() {
        $('#modelPerformance').html(`
            <div class="row">
                <div class="col-md-12 mb-3">
                    <div class="performance-card-3d">
                        <div class="performance-header-3d">
                            <i class="fas fa-tree text-success me-2"></i>
                            <h6 style="color: var(--text-primary);">Random Forest</h6>
                        </div>
                        <div class="performance-metrics-3d">
                            <div class="metric-3d">
                                <span class="metric-label-3d">Ø¯Ù‚Ø© Ø¹Ø§Ù…Ø©:</span>
                                <span class="metric-value-3d">87.5%</span>
                            </div>
                            <div class="metric-3d">
                                <span class="metric-label-3d">Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù…ØªÙˆØ³Ø·:</span>
                                <span class="metric-value-3d">11.2</span>
                            </div>
                            <div class="metric-3d">
                                <span class="metric-label-3d">Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯:</span>
                                <span class="metric-value-3d">0.823</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `);
    }
    
    function loadDetailedPerformance() {
        $('#detailedPerformanceContent').html(`
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...</span>
                </div>
                <p class="mt-3 text-muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙØµÙ„Ø©...</p>
            </div>
        `);
        
        $.ajax({
            url: '/api/prediction/performance/',
            method: 'GET',
            success: function(data) {
                const metrics = data.performance_metrics;
                let content = '';
                
                // Performance Summary
                content += `
                    <div class="row mb-4 performance-modal-rtl">
                        <div class="col-12">
                            <h6 class="text-primary mb-3 arabic-text">
                                <i class="fas fa-tachometer-alt me-2"></i>Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…
                            </h6>
                        </div>
                `;
                
                Object.keys(metrics).forEach((subject, index) => {
                    const metric = metrics[subject];
                    const colors = ['#B85C57', '#28a745', '#ffc107'];
                    
                    content += `
                        <div class="col-md-4 mb-3">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <h5 class="arabic-text" style="color: ${colors[index]};">${subject}</h5>
                                    <div class="row metric-row">
                                        <div class="col-6 metric-container">
                                            <div class="metric-box">
                                                <div class="arabic-text">Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</div>
                                                <div class="english-number">${(metric.test_r2 * 100).toFixed(1)}%</div>
                                            </div>
                                        </div>
                                        <div class="col-6 metric-container">
                                            <div class="metric-box">
                                                <div class="arabic-text">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù…Ø·Ù„Ù‚</div>
                                                <div class="english-number">${metric.test_mae.toFixed(1)}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-2 metric-row">
                                        <div class="col-6 metric-container">
                                            <div class="metric-box">
                                                <div class="arabic-text">Ø¯Ù‚Ø© Â±10</div>
                                                <div class="english-number">${metric.test_accuracy_10.toFixed(1)}%</div>
                                            </div>
                                        </div>
                                        <div class="col-6 metric-container">
                                            <div class="metric-box">
                                                <div class="arabic-text">Ø¯Ù‚Ø© Â±5</div>
                                                <div class="english-number">${metric.test_accuracy_5.toFixed(1)}%</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                content += '</div>';
                
                // Confusion Matrices
                content += `
                    <div class="row mb-4 performance-modal-rtl">
                        <div class="col-12">
                            <h6 class="text-primary mb-3 arabic-text">
                                <i class="fas fa-table me-2"></i>Ù…ØµÙÙˆÙØ§Øª Ø§Ù„Ø®Ù„Ø·
                            </h6>
                        </div>
                `;
                
                Object.keys(metrics).forEach(subject => {
                    const metric = metrics[subject];
                    if (metric.confusion_matrix_img) {
                        content += `
                            <div class="col-md-4 mb-3">
                                <div class="card">
                                    <div class="card-header text-center">
                                        <h6 class="arabic-text">${subject}</h6>
                                    </div>
                                    <div class="card-body text-center">
                                        <img src="data:image/png;base64,${metric.confusion_matrix_img}" 
                                             class="img-fluid" alt="Confusion Matrix - ${subject}">
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
                
                content += '</div>';
                
                // Residuals Plots
                content += `
                    <div class="row mb-4 performance-modal-rtl">
                        <div class="col-12">
                            <h6 class="text-primary mb-3 arabic-text">
                                <i class="fas fa-chart-scatter me-2"></i>Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ
                            </h6>
                        </div>
                `;
                
                Object.keys(metrics).forEach(subject => {
                    const metric = metrics[subject];
                    if (metric.residuals_img) {
                        content += `
                            <div class="col-md-4 mb-3">
                                <div class="card">
                                    <div class="card-header text-center">
                                        <h6 class="arabic-text">${subject}</h6>
                                    </div>
                                    <div class="card-body text-center">
                                        <img src="data:image/png;base64,${metric.residuals_img}" 
                                             class="img-fluid" alt="Residuals Plot - ${subject}">
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
                
                content += '</div>';
                
                // Actual vs Predicted Plots
                content += `
                    <div class="row mb-4 performance-modal-rtl">
                        <div class="col-12">
                            <h6 class="text-primary mb-3 arabic-text">
                                <i class="fas fa-chart-line me-2"></i>Ø§Ù„ÙØ¹Ù„ÙŠ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…ØªÙ†Ø¨Ø£
                            </h6>
                        </div>
                `;
                
                Object.keys(metrics).forEach(subject => {
                    const metric = metrics[subject];
                    if (metric.actual_vs_pred_img) {
                        content += `
                            <div class="col-md-4 mb-3">
                                <div class="card">
                                    <div class="card-header text-center">
                                        <h6 class="arabic-text">${subject}</h6>
                                    </div>
                                    <div class="card-body text-center">
                                        <img src="data:image/png;base64,${metric.actual_vs_pred_img}" 
                                             class="img-fluid" alt="Actual vs Predicted - ${subject}">
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
                
                content += '</div>';
                
                // Feature Importance
                content += `
                    <div class="row performance-modal-rtl">
                        <div class="col-12">
                            <h6 class="text-primary mb-3 arabic-text">
                                <i class="fas fa-weight-hanging me-2"></i>Ø£Ù‡Ù…ÙŠØ© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
                            </h6>
                        </div>
                `;
                
                Object.keys(metrics).forEach(subject => {
                    const metric = metrics[subject];
                    const importance = metric.feature_importance;
                    
                    // Translate feature names to Arabic
                    const featureTranslations = {
                        'gender': 'Ø§Ù„Ø¬Ù†Ø³',
                        'race/ethnicity': 'Ø§Ù„Ø¹Ø±Ù‚/Ø§Ù„Ø¥Ø«Ù†ÙŠØ©',
                        'parental level of education': 'Ù…Ø³ØªÙˆÙ‰ ØªØ¹Ù„ÙŠÙ… Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†',
                        'lunch': 'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¬Ø¨Ø©',
                        'test preparation course': 'Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±'
                    };
                    
                    content += `
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <div class="card-header text-center">
                                    <h6 class="arabic-text">${subject}</h6>
                                </div>
                                <div class="card-body feature-importance-rtl">
                    `;
                    
                    Object.keys(importance).forEach(feature => {
                        const value = (importance[feature] * 100).toFixed(1);
                        const arabicFeature = featureTranslations[feature] || feature;
                        content += `
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="small arabic-text">${arabicFeature}</span>
                                <div class="d-flex align-items-center">
                                    <div class="progress me-2" style="width: 100px; height: 8px;">
                                        <div class="progress-bar" style="width: ${value}%; background-color: #B85C57;"></div>
                                    </div>
                                    <span class="small text-muted english-number">${value}%</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    content += `
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                content += '</div>';
                
                $('#detailedPerformanceContent').html(content);
            },
            error: function() {
                $('#detailedPerformanceContent').html(`
                    <div class="alert alert-warning text-center">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„</strong>
                        <p class="mb-0 mt-2">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£ÙˆÙ„Ø§Ù‹</p>
                    </div>
                `);
            }
        });
    }
    
    // Ø¯Ø§Ù„Ø© ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
    function checkModelStatus() {
        $.ajax({
            url: '/api/prediction/status/',
            method: 'GET',
            success: function(data) {
                if (data.models_ready) {
                    // Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù…Ø¯Ø±Ø¨Ø© ÙˆÙ…ØªØ§Ø­Ø© - ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                    $('#predictionForm input, #predictionForm select, #predictionForm button[type="submit"]').prop('disabled', false);
                    $('#modelStatus').html(`
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªÙ†Ø¨Ø¤
                        </div>
                    `);
                    console.log('âœ… Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù…Ø¯Ø±Ø¨Ø© ÙˆØ¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªÙ†Ø¨Ø¤');
                } else {
                    // Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ØºÙŠØ± Ù…Ø¯Ø±Ø¨Ø© - ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                    $('#predictionForm input, #predictionForm select, #predictionForm button[type="submit"]').prop('disabled', true);
                    
                    $('#modelStatus').html(`
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            ${data.message || 'Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ØºÙŠØ± Ù…Ø¯Ø±Ø¨Ø©'}
                        </div>
                    `);
                    
                    $('#predictionResults').html(`
                        <div class="alert alert-warning text-center">
                            <i class="fas fa-exclamation-triangle me-2" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            <h6>ÙŠØ¬Ø¨ ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø£ÙˆÙ„Ø§Ù‹</h6>
                            <p>Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø¯ÙˆÙ† ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø£ÙˆÙ„Ø§Ù‹</p>
                            <button class="btn btn-primary" onclick="$('#trainModel').click()">
                                <i class="fas fa-play me-1"></i>Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø¢Ù†
                            </button>
                        </div>
                    `);
                    
                    console.log('âš ï¸ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ØºÙŠØ± Ù…Ø¯Ø±Ø¨Ø© - ÙŠØ¬Ø¨ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø£ÙˆÙ„Ø§Ù‹');
                }
            },
            error: function(xhr) {
                // Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ - ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ø­ØªÙŠØ§Ø·ÙŠØ§Ù‹
                $('#predictionForm input, #predictionForm select, #predictionForm button[type="submit"]').prop('disabled', true);
                
                $('#modelStatus').html(`
                    <div class="alert alert-danger">
                        <i class="fas fa-times-circle me-2"></i>Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
                    </div>
                `);
                
                console.log('âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬');
            }
        });
    }
});
</script>
{% endblock %}
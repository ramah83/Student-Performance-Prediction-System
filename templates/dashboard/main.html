{% extends 'base.html' %}

{% block title %}RAM - ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ{% endblock %}

{% block content %}
<div class="col-12">
    <div class="main-content">
        
        <div class="page-header-3d fade-in-up">
            <h1>ููุญุฉ ุชุญูู ุงูุทูุงุจ</h1>
            <p>ููุตุฉ ุฐููุฉ ููุชูุจุค ูุชุญููู ุงูุฃุฏุงุก ุงูุชุนูููู ุจุงุณุชุฎุฏุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู</p>
        </div>

        
        <div class="row mb-4">
            <div class="col-md-3 col-6 mb-3">
                <div class="stats-card-3d fade-in-left float-element">
                    <div class="stats-icon-3d">ุงูุทูุงุจ</div>
                    <div class="stats-number-3d" id="totalStudents" data-target="1000">-</div>
                    <div class="stats-label-3d">ุฅุฌูุงูู ุงูุทูุงุจ</div>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-3">
                <div class="stats-card-3d fade-in-up float-element">
                    <div class="stats-icon-3d">ุงูุฑูุงุถูุงุช</div>
                    <div class="stats-number-3d" id="avgMath" data-target="66">-</div>
                    <div class="stats-label-3d">ูุชูุณุท ุงูุฑูุงุถูุงุช</div>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-3">
                <div class="stats-card-3d fade-in-up float-element">
                    <div class="stats-icon-3d">ุงููุฑุงุกุฉ</div>
                    <div class="stats-number-3d" id="avgReading" data-target="69">-</div>
                    <div class="stats-label-3d">ูุชูุณุท ุงููุฑุงุกุฉ</div>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-3">
                <div class="stats-card-3d fade-in-right float-element">
                    <div class="stats-icon-3d">ุงููุชุงุจุฉ</div>
                    <div class="stats-number-3d" id="avgWriting" data-target="68">-</div>
                    <div class="stats-label-3d">ูุชูุณุท ุงููุชุงุจุฉ</div>
                </div>
            </div>
        </div>

        
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card-3d fade-in-left">
                    <div class="text-center mb-4">
                        <div class="stats-icon-3d" style="font-size: 2rem; margin-bottom: 20px;">ุงูุชูุจุค ุงูุฐูู</div>
                        <h4 style="color: var(--text-primary); margin-bottom: 15px;">ูุธุงู ุงูุชูุจุค ุจุงูุฏุฑุฌุงุช</h4>
                    </div>
                   <p style="color: var(--text-secondary);margin-bottom: 20px;line-height: 1.6;margin-right: 20px;font-weight: bold;">
    ุชูุจุค ุฐูู ุจุฏุฑุฌุงุช ุงูุทูุงุจ ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุงุช ุงูุชุนูู ุงูุขูู ุงููุชุทูุฑุฉ
</p>
                    <div class="text-center">
                        <a href="/prediction/dashboard/" class="btn-3d micro-bounce">
                            ุงุจุฏุฃ ุงูุชูุจุค
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="card-3d fade-in-right">
                    <div class="text-center mb-4">
                        <div class="stats-icon-3d" style="font-size: 2rem; margin-bottom: 20px;">ุงูุชุฌููุน ุงูุฐูู</div>
                        <h4 style="color: var(--text-primary); margin-bottom: 15px;">ูุธุงู ุชุฌููุน ุงูุทูุงุจ</h4>
                    </div>
                    <p style="color: var(--text-secondary);margin-bottom: 20px;line-height: 1.6;margin-right: 20px; font-weight: bold;">
                        ุชุฌููุน ุฐูู ููุทูุงุจ ุญุณุจ ุงูุฃุฏุงุก ูุงูุฎุตุงุฆุต ูุชุญุณูู ุงูุนูููุฉ ุงูุชุนููููุฉ
                    </p>
                    <div class="text-center">
                        <a href="/clustering/dashboard/" class="btn-3d micro-bounce">
                            ุนุฑุถ ุงูุชุฌููุน
                        </a>
                    </div>
                </div>
            </div>
        </div>

        
        <div class="row mb-4">
            <div class="col-12">
                <div class="clustering-distribution">
                    <div class="distribution-header">
                        <h4 class="distribution-title">
                            <i class="fas fa-chart-pie" style="margin-left: 10px;"></i>
                            ุงูุชูุฒูุน ุงูุชูุงุนูู ูููุฌููุนุงุช
                        </h4>
                        <p class="distribution-subtitle">ุชุญููู ุดุงูู ูุชูุฒูุน ุงูุทูุงุจ ุญุณุจ ูุณุชูู ุงูุฃุฏุงุก ุงูุฃูุงุฏููู</p>
                    </div>

                    
                    <div class="clusters-grid">
                        
                        <div class="cluster-item fade-in-up">
                            <div class="cluster-header">
                                <div class="cluster-title">
                                    ุงููุชููููู
                                </div>
                                <div class="cluster-count" id="excellentStudents">-</div>
                            </div>
                            <div class="cluster-description">
                                ุทูุงุจ ูุญูููู ุฏุฑุฌุงุช ููุชุงุฒุฉ ูู ุฌููุน ุงูููุงุฏ ููุธูุฑูู ุชูููุงู ุฃูุงุฏูููุงู ูุณุชูุฑุงู
                            </div>
                            <div class="cluster-progress">
                                <div class="cluster-progress-label">
                                    <span>ูุณุจุฉ ุงูุชููู</span>
                                    <span id="excellentPercentage">25%</span>
                                </div>
                                <div class="cluster-progress-bar-container">
                                    <div class="cluster-progress-bar" id="excellentProgressBar" style="width: 25%; background: linear-gradient(135deg, #28a745 0%, #20a83a 100%);"></div>
                                </div>
                            </div>
                        </div>

                        
                        <div class="cluster-item fade-in-up">
                            <div class="cluster-header">
                                <div class="cluster-title">
                                    ุงูุฌูุฏูู
                                </div>
                                <div class="cluster-count" id="goodStudents">-</div>
                            </div>
                            <div class="cluster-description">
                                ุทูุงุจ ุจุฃุฏุงุก ุฌูุฏ ููุณุชูุฑ ูุญุชุงุฌูู ุชุดุฌูุน ูุณุชูุฑ ูููุตูู ููุชููู
                            </div>
                            <div class="cluster-progress">
                                <div class="cluster-progress-label">
                                    <span>ูุณุจุฉ ุงูุฃุฏุงุก ุงูุฌูุฏ</span>
                                    <span id="goodPercentage">35%</span>
                                </div>
                                <div class="cluster-progress-bar-container">
                                    <div class="cluster-progress-bar" id="goodProgressBar" style="width: 35%; background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);"></div>
                                </div>
                            </div>
                        </div>

                        
                        <div class="cluster-item fade-in-up">
                            <div class="cluster-header">
                                <div class="cluster-title">
                                    ุงููุชูุณุทูู
                                </div>
                                <div class="cluster-count" id="averageStudents">-</div>
                            </div>
                            <div class="cluster-description">
                                ุทูุงุจ ุจุฃุฏุงุก ูุชูุณุท ูุญุชุงุฌูู ุฏุนู ุฅุถุงูู ูุชุญุณูู ูุณุชูุงูู ุงูุฃูุงุฏููู
                            </div>
                            <div class="cluster-progress">
                                <div class="cluster-progress-label">
                                    <span>ูุณุจุฉ ุงูุฃุฏุงุก ุงููุชูุณุท</span>
                                    <span id="averagePercentage">25%</span>
                                </div>
                                <div class="cluster-progress-bar-container">
                                    <div class="cluster-progress-bar" id="averageProgressBar" style="width: 25%; background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);"></div>
                                </div>
                            </div>
                        </div>

                        
                        <div class="cluster-item fade-in-up">
                            <div class="cluster-header">
                                <div class="cluster-title">
                                    ูุญุชุงุฌูู ุฏุนู
                                </div>
                                <div class="cluster-count" id="needSupportStudents">-</div>
                            </div>
                            <div class="cluster-description">
                                ุทูุงุจ ูุญุชุงุฌูู ูุณุงุนุฏุฉ ููุชุงุจุนุฉ ููุซูุฉ ูุชุญุณูู ุฃุฏุงุฆูู ุงูุฃูุงุฏููู
                            </div>
                            <div class="cluster-progress">
                                <div class="cluster-progress-label">
                                    <span>ูุณุจุฉ ุงููุญุชุงุฌูู ููุฏุนู</span>
                                    <span id="supportPercentage">15%</span>
                                </div>
                                <div class="cluster-progress-bar-container">
                                    <div class="cluster-progress-bar" id="supportProgressBar" style="width: 15%; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="chart-wrapper">
                        <div class="chart-controls">
                            <button class="chart-control-btn active" data-type="bar">
                                <i class="fas fa-chart-bar" style="margin-left: 5px;"></i>ุฃุนูุฏุฉ
                            </button>
                            <button class="chart-control-btn" data-type="pie">
                                <i class="fas fa-chart-pie" style="margin-left: 5px;"></i>ุฏุงุฆุฑู
                            </button>
                            <button class="chart-control-btn" data-type="donut">
                                <i class="fas fa-circle-notch" style="margin-left: 5px;"></i>ุญููู
                            </button>
                        </div>
                        <div id="clusterChart" style="min-height: 350px;"></div>
                    </div>

                    
                    <div class="additional-charts mt-4">
                        
                        <div class="chart-section mb-4">
                            <h5 class="chart-section-title">
                                <i class="fas fa-chart-line me-2"></i>
                                ููุงุฑูุฉ ุงูุฃุฏุงุก ุจูู ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ
                            </h5>
                            <div id="subjectsComparisonChart" style="min-height: 400px;"></div>
                        </div>

                        
                        <div class="chart-section mb-4">
                            <h5 class="chart-section-title">
                                <i class="fas fa-trending-up me-2"></i>
                                ุงุชุฌุงูุงุช ุงูุฃุฏุงุก ุนุจุฑ ุงูููุช
                            </h5>
                            <div id="trendsChart" style="min-height: 400px;"></div>
                        </div>

                        
                        <div class="chart-section mb-4">
                            <h5 class="chart-section-title">
                                <i class="fas fa-map-marked-alt me-2"></i>
                                ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ููุทูุงุจ
                            </h5>
                            <div id="geographicChart" style="min-height: 400px;"></div>
                        </div>

                        
                        <div class="performance-indicators-section mb-4">
                            <h5 class="chart-section-title">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณูุฉ
                            </h5>
                            <div id="performanceIndicators"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
        <div class="row mb-4">
            <div class="col-12">
                <div class="data-insight-card fade-in-up">
                    <div class="insight-header">
                        <h4 class="insight-title">
                            <i class="fas fa-lightbulb me-2"></i>
                            ุฑุคู ุฐููุฉ ูู ุงูุจูุงูุงุช
                        </h4>
                        <span class="insight-badge">ุชุญููู ูุชูุฏู</span>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="insight-item">
                                <div class="insight-icon bg-success">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <div class="insight-content">
                                    <h6>ูุนุฏู ุงููุฌุงุญ ุงููุฑุชูุน</h6>
                                    <p class="mb-0">ุฃูุซุฑ ูู 75% ูู ุงูุทูุงุจ ูุญูููู ูุชุงุฆุฌ ุฌูุฏุฉ ุฅูู ููุชุงุฒุฉ ูู ุฌููุน ุงูููุงุฏ</p>
                                    <div class="insight-progress mt-2">
                                        <div class="progress-3d">
                                            <div class="progress-bar-3d" style="width: 75%; background: var(--success-gradient);"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="insight-item">
                                <div class="insight-icon bg-info">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="insight-content">
                                    <h6>ุชูุฒูุน ูุชูุงุฒู</h6>
                                    <p class="mb-0">ุงูุชูุฒูุน ูุธูุฑ ุชููุน ุตุญู ูู ูุณุชููุงุช ุงูุฃุฏุงุก ุงูุฃูุงุฏููู</p>
                                    <div class="insight-progress mt-2">
                                        <div class="progress-3d">
                                            <div class="progress-bar-3d" style="width: 85%; background: var(--secondary-gradient);"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="insight-item">
                                <div class="insight-icon bg-warning">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="insight-content">
                                    <h6>ูุฑุต ุงูุชุญุณูู</h6>
                                    <p class="mb-0">25% ูู ุงูุทูุงุจ ูุญุชุงุฌูู ุฏุนู ุฅุถุงูู ูุชุญุณูู ุฃุฏุงุฆูู ุงูุฃูุงุฏููู</p>
                                    <div class="insight-progress mt-2">
                                        <div class="progress-3d">
                                            <div class="progress-bar-3d" style="width: 25%; background: var(--warning-gradient);"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="insight-item">
                                <div class="insight-icon bg-primary">
                                    <i class="fas fa-brain"></i>
                                </div>
                                <div class="insight-content">
                                    <h6>ุชูุตูุฉ ุฐููุฉ</h6>
                                    <p class="mb-0">ุงุณุชุฎุฏู ูุธุงู ุงูุชูุจุค ูุชุญุฏูุฏ ุงูุทูุงุจ ุงููุนุฑุถูู ููุฎุทุฑ ูุจูุฑุงู</p>
                                    <div class="insight-progress mt-2">
                                        <div class="progress-3d">
                                            <div class="progress-bar-3d" style="width: 90%; background: var(--primary-gradient);"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
        <div class="row mb-4">
            <div class="col-12">
                <div class="support-needed fade-in-up">
                    <div class="support-header">
                        <h4 class="support-title">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            ุทูุงุจ ูุญุชุงุฌูู ุฏุนู ุนุงุฌู
                        </h4>
                        <span class="support-count" id="supportCount">-</span>
                    </div>
                    
                    <div class="support-list" id="supportStudentsList">
                        
                    </div>
                    
                    <div class="action-buttons mt-4">
                        <button class="btn-action btn-primary-action" onclick="generateSupportPlan()">
                            <i class="fas fa-clipboard-list me-2"></i>
                            ุฅูุดุงุก ุฎุทุฉ ุฏุนู
                        </button>
                        <button class="btn-action btn-secondary-action" onclick="exportSupportList()">
                            <i class="fas fa-download me-2"></i>
                            ุชุตุฏูุฑ ุงููุงุฆูุฉ
                        </button>
                        <button class="btn-action btn-success-action" onclick="scheduleFollowUp()">
                            <i class="fas fa-calendar-plus me-2"></i>
                            ุฌุฏููุฉ ูุชุงุจุนุฉ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card-3d fade-in-left">
                    <div class="card-header-3d">
                        <h5><i class="fas fa-info-circle me-2"></i>ูุนูููุงุช ุงููุดุฑูุน</h5>
                    </div>
                    <div class="card-body-3d">
                        <div class="mb-3">
                            <h6 class="text-secondary mb-2">ุงููุฏู ูู ุงููุดุฑูุน:</h6>
                            <p class="text-muted mb-3">ุชุทููุฑ ูุธุงู ุฐูู ูุชุทูุฑ ููุชูุจุค ุจุฃุฏุงุก ุงูุทูุงุจ ูุชุฌููุนูู ูู ูุฌููุนุงุช ูุชุดุงุจูุฉ ูุชุญุณูู ุงูุนูููุฉ ุงูุชุนููููุฉ ูุชูุฏูู ุชุฌุฑุจุฉ ุชุนููููุฉ ูุฎุตุตุฉ.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="text-secondary mb-2">ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ:</h6>
                            <div class="tech-stack">
                                <span class="tech-badge"><i class="fab fa-python me-1"></i>Django & Python</span>
                                <span class="tech-badge"><i class="fas fa-robot me-1"></i>Scikit-Learn</span>
                                <span class="tech-badge"><i class="fas fa-table me-1"></i>Pandas & NumPy</span>
                                <span class="tech-badge"><i class="fas fa-chart-line me-1"></i>Plotly</span>
                            </div>
                        </div>
                        
                        <div class="project-stats">
                            <div class="stat-item">
                                <span class="stat-value" id="projectAccuracy">95.2%</span>
                                <span class="stat-label">ุฏูุฉ ุงููููุฐุฌ</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="dataPoints">1000+</span>
                                <span class="stat-label">ููุทุฉ ุจูุงูุงุช</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="card-3d fade-in-right">
                    <div class="card-header-3d">
                        <h5><i class="fas fa-brain me-2"></i>ุฎูุงุฑุฒููุงุช ุงูุชุนูู ุงูุขูู</h5>
                    </div>
                    <div class="card-body-3d">
                        <div class="mb-3">
                            <h6 class="text-success mb-2"><i class="fas fa-chart-line me-2"></i>ุฎูุงุฑุฒููุงุช ุงูุชูุจุค:</h6>
                            <div class="algorithm-list">
                                <div class="algorithm-item">
                                    <i class="fas fa-tree text-success me-2"></i>
                                    <span>ุงูุบุงุจุฉ ุงูุนุดูุงุฆูุฉ ููุงูุญุฏุงุฑ</span>
                                    <span class="accuracy-badge">94.5%</span>
                                </div>
                                <div class="algorithm-item">
                                    <i class="fas fa-line-chart text-info me-2"></i>
                                    <span>ุงูุงูุญุฏุงุฑ ุงูุฎุทู</span>
                                    <span class="accuracy-badge">87.2%</span>
                                </div>
                                <div class="algorithm-item">
                                    <i class="fas fa-network-wired text-warning me-2"></i>
                                    <span>ุงูุดุจูุงุช ุงูุนุตุจูุฉ (Keras)</span>
                                    <span class="accuracy-badge">96.1%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="text-info mb-2"><i class="fas fa-project-diagram me-2"></i>ุฎูุงุฑุฒููุงุช ุงูุชุฌููุน:</h6>
                            <div class="algorithm-list">
                                <div class="algorithm-item">
                                    <i class="fas fa-circle-nodes text-primary me-2"></i>
                                    <span>ุชุฌููุน ุงููุณุงุฆู ุงูููู (K-Means)</span>
                                    <span class="accuracy-badge">92.8%</span>
                                </div>
                                <div class="algorithm-item">
                                    <i class="fas fa-compress-arrows-alt text-secondary me-2"></i>
                                    <span>ุชุญููู ุงูููููุงุช ุงูุฃุณุงุณูุฉ (PCA)</span>
                                    <span class="accuracy-badge">89.3%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="data-source-info">
                            <i class="fas fa-database me-2"></i>
                            <strong>ูุตุฏุฑ ุงูุจูุงูุงุช:</strong> ูุฌููุนุฉ ุจูุงูุงุช ุฃุฏุงุก ุงูุทูุงุจ ูู ุงูุงูุชุญุงูุงุช
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>

$(document).ready(function() {
    console.log('๐ ุจุฏุก ุชุญููู ููุญุฉ ุงูุชุญูู...');
    
    
    $('#totalStudents, #avgMath, #avgReading, #avgWriting').text('0');
    $('#excellentStudents, #goodStudents, #averageStudents, #needSupportStudents').text('0');
    
    
    $('#clusterChart').html(`
        <div style="text-align: center; padding: 30px; color: #6c757d;">
            <i class="fas fa-chart-bar" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>ุฌุงุฑู ุฅุนุฏุงุฏ ุงูุฑุณู ุงูุจูุงูู...</p>
        </div>
    `);
    
    
    loadDashboardData();
});


function loadDashboardData() {
    $.ajax({
        url: '/dashboard/api/data/',
        method: 'GET',
        dataType: 'json',
        timeout: 10000
    })
    .done(function(data) {
        console.log('โ ุชู ุชุญููู ุงูุจูุงูุงุช ุจูุฌุงุญ:', data);
        displayData(data);
    })
    .fail(function(xhr, status, error) {
        console.log('โ๏ธ ูุดู ุชุญููู ุงูุจูุงูุงุชุ ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ');
        const fallbackData = {
            total_students: 1000,
            avg_math_score: 66.1,
            avg_reading_score: 69.2,
            avg_writing_score: 68.1,
            clusters: [
                {name: 'ุงููุชููููู', count: 250, percentage: 25.0},
                {name: 'ุงูุฌูุฏูู', count: 350, percentage: 35.0},
                {name: 'ุงููุชูุณุทูู', count: 250, percentage: 25.0},
                {name: 'ุงููุญุชุงุฌูู ููุฏุนู', count: 150, percentage: 15.0}
            ]
        };
        displayData(fallbackData);
    });
}


function displayData(data) {
    
    animateNumber('#totalStudents', data.total_students || 1000);
    animateNumber('#avgMath', Math.round(data.avg_math_score || 66.1));
    animateNumber('#avgReading', Math.round(data.avg_reading_score || 69.2));
    animateNumber('#avgWriting', Math.round(data.avg_writing_score || 68.1));
    
    
    const clusterData = data.clusters || [
        {name: 'ุงููุชููููู', count: 250, percentage: 25.0},
        {name: 'ุงูุฌูุฏูู', count: 350, percentage: 35.0},
        {name: 'ุงููุชูุณุทูู', count: 250, percentage: 25.0},
        {name: 'ุงููุญุชุงุฌูู ููุฏุนู', count: 150, percentage: 15.0}
    ];
    
    
    const colors = ['#28a745', '#17a2b8', '#ffc107', '#dc3545'];
    clusterData.forEach((cluster, index) => {
        cluster.color = colors[index];
    });
    
    
    setTimeout(() => animateNumber('#excellentStudents', clusterData[0]?.count || 0), 500);
    setTimeout(() => animateNumber('#goodStudents', clusterData[1]?.count || 0), 700);
    setTimeout(() => animateNumber('#averageStudents', clusterData[2]?.count || 0), 900);
    setTimeout(() => animateNumber('#needSupportStudents', clusterData[3]?.count || 0), 1100);
    
    
    createChart(clusterData, 'bar');
    
    
    $('.chart-control-btn').click(function() {
        $('.chart-control-btn').removeClass('active');
        $(this).addClass('active');
        const type = $(this).data('type');
        createChart(clusterData, type);
    });
}


function animateNumber(element, target) {
    const $element = $(element);
    const start = 0;
    const duration = 2000;
    const startTime = performance.now();
    
    function updateNumber(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const easeOutQuart = 1 - Math.pow(1 - progress, 4);
        const current = Math.floor(start + (target - start) * easeOutQuart);
        
        $element.text(current);
        
        if (progress < 1) {
            requestAnimationFrame(updateNumber);
        } else {
            $element.text(target);
        }
    }
    
    requestAnimationFrame(updateNumber);
}


function createChart(clusterData, type = 'bar') {
    console.log('๐จ ุฅูุดุงุก ุฑุณู ุจูุงูู:', type);
    
    if (!clusterData || clusterData.length === 0) {
        console.error('โ ูุง ุชูุฌุฏ ุจูุงูุงุช ููุฑุณู');
        return;
    }
    
    let trace, layout;
    
    if (type === 'bar') {
        trace = {
            x: clusterData.map(c => c.name),
            y: clusterData.map(c => c.count),
            type: 'bar',
            marker: {
                color: clusterData.map(c => c.color),
                line: { color: '#FFFFFF', width: 2 },
                opacity: 0.9
            },
            text: clusterData.map(c => `${c.count} ุทุงูุจ`),
            textposition: 'auto',
            textfont: { color: 'white', size: 14, family: 'Cairo', weight: 'bold' },
            hovertemplate: '<b>%{x}</b><br>ุนุฏุฏ ุงูุทูุงุจ: %{y}<br><extra></extra>'
        };
        
        layout = {
            title: {
                text: '๐ ุชูุฒูุน ุงูุทูุงุจ ุญุณุจ ูุณุชูู ุงูุฃุฏุงุก',
                font: { family: 'Cairo', size: 18, color: '#2C2C2C' },
                x: 0.5
            },
            xaxis: { 
                title: { text: 'ูุฌููุนุงุช ุงูุทูุงุจ', font: { family: 'Cairo', size: 12 } },
                font: { family: 'Cairo', size: 10 }
            },
            yaxis: { 
                title: { text: 'ุนุฏุฏ ุงูุทูุงุจ', font: { family: 'Cairo', size: 12 } },
                font: { family: 'Cairo', size: 10 }
            }
        };
    } else if (type === 'pie') {
        trace = {
            labels: clusterData.map(c => c.name),
            values: clusterData.map(c => c.count),
            type: 'pie',
            marker: {
                colors: clusterData.map(c => c.color),
                line: { color: '#FFFFFF', width: 3 }
            },
            textinfo: 'label+percent+value',
            textfont: { family: 'Cairo', size: 12, weight: 'bold' },
            hovertemplate: '<b>%{label}</b><br>ุงูุนุฏุฏ: %{value}<br>ุงููุณุจุฉ: %{percent}<br><extra></extra>'
        };
        
        layout = {
            title: {
                text: '๐ฅง ุงูุชูุฒูุน ุงูุฏุงุฆุฑู ููุทูุงุจ',
                font: { family: 'Cairo', size: 18, color: '#2C2C2C' },
                x: 0.5
            }
        };
    } else if (type === 'donut') {
        const total = clusterData.reduce((sum, c) => sum + c.count, 0);
        
        trace = {
            labels: clusterData.map(c => c.name),
            values: clusterData.map(c => c.count),
            type: 'pie',
            hole: 0.5,
            marker: {
                colors: clusterData.map(c => c.color),
                line: { color: '#FFFFFF', width: 3 }
            },
            textinfo: 'label+percent',
            textfont: { family: 'Cairo', size: 11, weight: 'bold' },
            hovertemplate: '<b>%{label}</b><br>ุงูุนุฏุฏ: %{value}<br>ุงููุณุจุฉ: %{percent}<br><extra></extra>'
        };
        
        layout = {
            title: {
                text: '๐ฉ ุงูุฑุณู ุงูุญููู ููุทูุงุจ',
                font: { family: 'Cairo', size: 18, color: '#2C2C2C' },
                x: 0.5
            },
            annotations: [{
                text: `ุฅุฌูุงูู ุงูุทูุงุจ<br><b style="font-size: 24px; color: #B85C57;">${total}</b>`,
                x: 0.5, y: 0.5,
                font: { family: 'Cairo', size: 16, weight: 'bold', color: '#2C2C2C' },
                showarrow: false
            }]
        };
    }
    
    const commonLayout = {
        plot_bgcolor: '#FFFFFF',
        paper_bgcolor: '#FFFFFF',
        margin: { t: 60, b: 60, l: 60, r: 60 },
        showlegend: type !== 'bar',
        legend: {
            orientation: 'h',
            x: 0.5,
            xanchor: 'center',
            y: -0.1,
            font: { family: 'Cairo', size: 11 }
        },
        font: { family: 'Cairo' }
    };
    
    Object.assign(layout, commonLayout);
    
    try {
        Plotly.newPlot('clusterChart', [trace], layout, {
            responsive: true,
            displayModeBar: false,
            staticPlot: false
        });
        
        console.log('โ ุชู ุฅูุดุงุก ุงูุฑุณู ุงูุจูุงูู ุจูุฌุงุญ');
    } catch (error) {
        console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฑุณู ุงูุจูุงูู:', error);
        $('#clusterChart').html(`
            <div class="alert alert-info text-center">
                <i class="fas fa-info-circle me-2"></i>
                <strong>ุงูุฑุณู ุงูุจูุงูู ุบูุฑ ูุชุงุญ ุญุงููุงู</strong><br>
                <small>ุณูุชู ุชุญุฏูุซ ุงูุจูุงูุงุช ูุฑูุจุงู</small>
            </div>
        `);
    }
}


function generateSupportPlan() {
    console.log('๐ ุฅูุดุงุก ุฎุทุฉ ุฏุนู ููุทูุงุจ ุงููุญุชุงุฌูู...');
    
    
    Swal.fire({
        title: 'ุฅูุดุงุก ุฎุทุฉ ุงูุฏุนู',
        text: 'ูู ุชุฑูุฏ ุฅูุดุงุก ุฎุทุฉ ุฏุนู ูุฎุตุตุฉ ููุทูุงุจ ุงููุญุชุงุฌููุ',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'ูุนูุ ุฃูุดุฆ ุงูุฎุทุฉ',
        cancelButtonText: 'ุฅูุบุงุก',
        confirmButtonColor: '#28a745',
        cancelButtonColor: '#dc3545'
    }).then((result) => {
        if (result.isConfirmed) {
            
            Swal.fire({
                title: 'ุชู ุฅูุดุงุก ุงูุฎุทุฉ!',
                text: 'ุชู ุฅูุดุงุก ุฎุทุฉ ุฏุนู ุดุงููุฉ ููุทูุงุจ ุงููุญุชุงุฌูู ุจูุฌุงุญ',
                icon: 'success',
                confirmButtonText: 'ููุชุงุฒ'
            });
        }
    });
}

function exportSupportList() {
    console.log('๐ฅ ุชุตุฏูุฑ ูุงุฆูุฉ ุงูุทูุงุจ ุงููุญุชุงุฌูู ููุฏุนู...');
    
    
    const csvContent = "data:text/csv;charset=utf-8,ุงูุงุณู,ุงูุฑูุงุถูุงุช,ุงููุฑุงุกุฉ,ุงููุชุงุจุฉ,ุงููุณุชูู\n" +
        "ุฃุญูุฏ ูุญูุฏ,45,50,48,ูุญุชุงุฌ ุฏุนู\n" +
        "ูุงุทูุฉ ุนูู,52,49,51,ูุญุชุงุฌ ุฏุนู\n" +
        "ูุญูุฏ ุญุณู,48,46,47,ูุญุชุงุฌ ุฏุนู\n";
    
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "students_support_list.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    
    Swal.fire({
        title: 'ุชู ุงูุชุตุฏูุฑ!',
        text: 'ุชู ุชุตุฏูุฑ ูุงุฆูุฉ ุงูุทูุงุจ ุจูุฌุงุญ',
        icon: 'success',
        timer: 2000,
        showConfirmButton: false
    });
}

function scheduleFollowUp() {
    console.log('๐ ุฌุฏููุฉ ูุชุงุจุนุฉ ููุทูุงุจ...');
    
    Swal.fire({
        title: 'ุฌุฏููุฉ ุงููุชุงุจุนุฉ',
        html: `
            <div class="text-start">
                <div class="mb-3">
                    <label class="form-label">ุชุงุฑูุฎ ุงููุชุงุจุนุฉ:</label>
                    <input type="date" id="followUpDate" class="form-control" min="${new Date().toISOString().split('T')[0]}">
                </div>
                <div class="mb-3">
                    <label class="form-label">ููุน ุงููุชุงุจุนุฉ:</label>
                    <select id="followUpType" class="form-select">
                        <option value="individual">ูุชุงุจุนุฉ ูุฑุฏูุฉ</option>
                        <option value="group">ูุชุงุจุนุฉ ุฌูุงุนูุฉ</option>
                        <option value="parent">ุงุฌุชูุงุน ูุน ุงูุฃูู</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">ููุงุญุธุงุช:</label>
                    <textarea id="followUpNotes" class="form-control" rows="3" placeholder="ุฃุฏุฎู ููุงุญุธุงุช ุฅุถุงููุฉ..."></textarea>
                </div>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'ุฌุฏููุฉ ุงููุชุงุจุนุฉ',
        cancelButtonText: 'ุฅูุบุงุก',
        confirmButtonColor: '#28a745',
        preConfirm: () => {
            const date = document.getElementById('followUpDate').value;
            const type = document.getElementById('followUpType').value;
            const notes = document.getElementById('followUpNotes').value;
            
            if (!date) {
                Swal.showValidationMessage('ูุฑุฌู ุงุฎุชูุงุฑ ุชุงุฑูุฎ ุงููุชุงุจุนุฉ');
                return false;
            }
            
            return { date, type, notes };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire({
                title: 'ุชู ุงูุฌุฏููุฉ!',
                text: `ุชู ุฌุฏููุฉ ุงููุชุงุจุนุฉ ุจุชุงุฑูุฎ ${result.value.date}`,
                icon: 'success',
                confirmButtonText: 'ููุชุงุฒ'
            });
        }
    });
}


function loadSupportStudents() {
    const supportStudents = [
        { name: 'ุฃุญูุฏ ูุญูุฏ ุนูู', math: 45, reading: 50, writing: 48, risk: 'ุนุงูู' },
        { name: 'ูุงุทูุฉ ุนูู ุญุณู', math: 52, reading: 49, writing: 51, risk: 'ูุชูุณุท' },
        { name: 'ูุญูุฏ ุญุณู ุฃุญูุฏ', math: 48, reading: 46, writing: 47, risk: 'ุนุงูู' },
        { name: 'ููุฑ ุงูุฏูู ูุญูุฏ', math: 55, reading: 53, writing: 54, risk: 'ูุชูุณุท' },
        { name: 'ุณุงุฑุฉ ุฃุญูุฏ ุนูู', math: 49, reading: 51, writing: 50, risk: 'ูุชูุณุท' }
    ];
    
    const supportList = document.getElementById('supportStudentsList');
    const supportCount = document.getElementById('supportCount');
    
    if (supportList && supportCount) {
        supportCount.textContent = supportStudents.length;
        
        supportList.innerHTML = supportStudents.map(student => `
            <div class="support-student-item">
                <div class="student-info">
                    <div class="student-name">${student.name}</div>
                    <div class="student-scores">
                        <span class="score-item">ุฑูุงุถูุงุช: ${student.math}</span>
                        <span class="score-item">ูุฑุงุกุฉ: ${student.reading}</span>
                        <span class="score-item">ูุชุงุจุฉ: ${student.writing}</span>
                    </div>
                </div>
                <div class="risk-level risk-${student.risk === 'ุนุงูู' ? 'high' : 'medium'}">
                    ${student.risk}
                </div>
            </div>
        `).join('');
    }
}


function loadAdditionalCharts() {
    
    createSubjectsComparisonChart();
    
    
    createTrendsChart();
    
    
    createGeographicChart();
    
    
    createPerformanceIndicators();
}

function createSubjectsComparisonChart() {
    const subjects = ['ุงูุฑูุงุถูุงุช', 'ุงููุฑุงุกุฉ', 'ุงููุชุงุจุฉ'];
    const averages = [66.1, 69.2, 68.1];
    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1'];
    
    const trace = {
        x: subjects,
        y: averages,
        type: 'bar',
        marker: {
            color: colors,
            line: { color: '#FFFFFF', width: 2 }
        },
        text: averages.map(avg => `${avg.toFixed(1)}`),
        textposition: 'auto',
        textfont: { color: 'white', size: 14, family: 'Cairo', weight: 'bold' }
    };
    
    const layout = {
        title: {
            text: 'ูุชูุณุท ุงูุฏุฑุฌุงุช ููู ูุงุฏุฉ',
            font: { family: 'Cairo', size: 16, color: '#2C2C2C' }
        },
        xaxis: { 
            title: { text: 'ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ', font: { family: 'Cairo', size: 12 } },
            font: { family: 'Cairo', size: 10 }
        },
        yaxis: { 
            title: { text: 'ูุชูุณุท ุงูุฏุฑุฌุงุช', font: { family: 'Cairo', size: 12 } },
            font: { family: 'Cairo', size: 10 }
        },
        plot_bgcolor: '#FFFFFF',
        paper_bgcolor: '#FFFFFF',
        margin: { t: 60, b: 60, l: 60, r: 60 },
        font: { family: 'Cairo' }
    };
    
    try {
        Plotly.newPlot('subjectsComparisonChart', [trace], layout, {
            responsive: true,
            displayModeBar: false
        });
    } catch (error) {
        console.error('ุฎุทุฃ ูู ุฑุณู ููุงุฑูุฉ ุงูููุงุฏ:', error);
    }
}

function createTrendsChart() {
    const months = ['ููุงูุฑ', 'ูุจุฑุงูุฑ', 'ูุงุฑุณ', 'ุฃุจุฑูู', 'ูุงูู', 'ููููู'];
    const mathTrend = [64, 65, 66, 67, 66, 66];
    const readingTrend = [67, 68, 69, 70, 69, 69];
    const writingTrend = [66, 67, 68, 69, 68, 68];
    
    const traces = [
        {
            x: months,
            y: mathTrend,
            type: 'scatter',
            mode: 'lines+markers',
            name: 'ุงูุฑูุงุถูุงุช',
            line: { color: '#FF6B6B', width: 3 },
            marker: { size: 8 }
        },
        {
            x: months,
            y: readingTrend,
            type: 'scatter',
            mode: 'lines+markers',
            name: 'ุงููุฑุงุกุฉ',
            line: { color: '#4ECDC4', width: 3 },
            marker: { size: 8 }
        },
        {
            x: months,
            y: writingTrend,
            type: 'scatter',
            mode: 'lines+markers',
            name: 'ุงููุชุงุจุฉ',
            line: { color: '#45B7D1', width: 3 },
            marker: { size: 8 }
        }
    ];
    
    const layout = {
        title: {
            text: 'ุงุชุฌุงูุงุช ุงูุฃุฏุงุก ุนุจุฑ ุงูุฃุดูุฑ',
            font: { family: 'Cairo', size: 16, color: '#2C2C2C' }
        },
        xaxis: { 
            title: { text: 'ุงูุฃุดูุฑ', font: { family: 'Cairo', size: 12 } },
            font: { family: 'Cairo', size: 10 }
        },
        yaxis: { 
            title: { text: 'ูุชูุณุท ุงูุฏุฑุฌุงุช', font: { family: 'Cairo', size: 12 } },
            font: { family: 'Cairo', size: 10 }
        },
        plot_bgcolor: '#FFFFFF',
        paper_bgcolor: '#FFFFFF',
        margin: { t: 60, b: 60, l: 60, r: 60 },
        legend: {
            orientation: 'h',
            x: 0.5,
            xanchor: 'center',
            y: -0.1,
            font: { family: 'Cairo', size: 11 }
        },
        font: { family: 'Cairo' }
    };
    
    try {
        Plotly.newPlot('trendsChart', traces, layout, {
            responsive: true,
            displayModeBar: false
        });
    } catch (error) {
        console.error('ุฎุทุฃ ูู ุฑุณู ุงูุงุชุฌุงูุงุช:', error);
    }
}

function createGeographicChart() {
    const regions = ['ุงููุงูุฑุฉ', 'ุงูุฅุณููุฏุฑูุฉ', 'ุงูุฌูุฒุฉ', 'ุฃุณูุงู', 'ุงูุฃูุตุฑ'];
    const studentCounts = [350, 280, 220, 180, 120];
    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'];
    
    const trace = {
        labels: regions,
        values: studentCounts,
        type: 'pie',
        marker: {
            colors: colors,
            line: { color: '#FFFFFF', width: 3 }
        },
        textinfo: 'label+percent+value',
        textfont: { family: 'Cairo', size: 12, weight: 'bold' }
    };
    
    const layout = {
        title: {
            text: 'ุงูุชูุฒูุน ุงูุฌุบุฑุงูู ููุทูุงุจ',
            font: { family: 'Cairo', size: 16, color: '#2C2C2C' }
        },
        plot_bgcolor: '#FFFFFF',
        paper_bgcolor: '#FFFFFF',
        margin: { t: 60, b: 60, l: 60, r: 60 },
        showlegend: true,
        legend: {
            orientation: 'h',
            x: 0.5,
            xanchor: 'center',
            y: -0.1,
            font: { family: 'Cairo', size: 11 }
        },
        font: { family: 'Cairo' }
    };
    
    try {
        Plotly.newPlot('geographicChart', [trace], layout, {
            responsive: true,
            displayModeBar: false
        });
    } catch (error) {
        console.error('ุฎุทุฃ ูู ุงูุฑุณู ุงูุฌุบุฑุงูู:', error);
    }
}

function createPerformanceIndicators() {
    const indicators = [
        { 
            title: 'ูุนุฏู ุงููุฌุงุญ ุงูุนุงู', 
            value: 87, 
            color: '#28a745', 
            icon: 'fas fa-graduation-cap',
            description: 'ูุณุจุฉ ุงูุทูุงุจ ุงููุงุฌุญูู ูู ุฌููุน ุงูููุงุฏ',
            trend: '+3%'
        },
        { 
            title: 'ูุนุฏู ุงูุชุญุณู ุงูุดูุฑู', 
            value: 15, 
            color: '#17a2b8', 
            icon: 'fas fa-chart-line',
            description: 'ูุชูุณุท ุชุญุณู ุงูุฏุฑุฌุงุช ุดูุฑูุงู',
            trend: '+2%'
        },
        { 
            title: 'ูุณุชูู ุงูุฑุถุง ุงูุชุนูููู', 
            value: 94, 
            color: '#ffc107', 
            icon: 'fas fa-star',
            description: 'ุฑุถุง ุงูุทูุงุจ ุนู ุงูุนูููุฉ ุงูุชุนููููุฉ',
            trend: '+5%'
        },
        { 
            title: 'ุฏูุฉ ูุธุงู ุงูุชูุจุค', 
            value: 96, 
            color: '#6f42c1', 
            icon: 'fas fa-brain',
            description: 'ุฏูุฉ ุฎูุงุฑุฒููุงุช ุงูุชุนูู ุงูุขูู',
            trend: '+1%'
        }
    ];
    
    const indicatorsHtml = indicators.map((indicator, index) => `
        <div class="performance-indicator-enhanced fade-in-up" style="animation-delay: ${index * 0.2}s;">
            <div class="indicator-header">
                <div class="indicator-icon-enhanced" style="background: linear-gradient(135deg, ${indicator.color}, ${indicator.color}dd);">
                    <i class="${indicator.icon}"></i>
                </div>
                <div class="indicator-trend" style="color: ${indicator.color};">
                    <i class="fas fa-arrow-up"></i>
                    ${indicator.trend}
                </div>
            </div>
            
            <div class="indicator-body">
                <div class="indicator-title-enhanced">${indicator.title}</div>
                <div class="indicator-value-enhanced" style="color: ${indicator.color};">
                    ${indicator.value}%
                </div>
                <div class="indicator-description">${indicator.description}</div>
                
                <div class="indicator-progress-enhanced">
                    <div class="progress-track">
                        <div class="progress-fill" 
                             style="width: ${indicator.value}%; 
                                    background: linear-gradient(90deg, ${indicator.color}44, ${indicator.color});
                                    animation: progressFill 2s ease-out ${index * 0.3}s both;">
                        </div>
                    </div>
                    <div class="progress-percentage" style="color: ${indicator.color};">
                        ${indicator.value}%
                    </div>
                </div>
            </div>
            
            <div class="indicator-sparkline">
                <svg width="100%" height="30" viewBox="0 0 100 30">
                    <polyline 
                        points="0,25 20,20 40,15 60,10 80,8 100,5" 
                        fill="none" 
                        stroke="${indicator.color}" 
                        stroke-width="2"
                        opacity="0.6">
                    </polyline>
                    <circle cx="100" cy="5" r="3" fill="${indicator.color}">
                        <animate attributeName="r" values="3;5;3" dur="2s" repeatCount="indefinite"/>
                    </circle>
                </svg>
            </div>
        </div>
    `).join('');
    
    document.getElementById('performanceIndicators').innerHTML = `
        <div class="performance-indicators-grid">
            ${indicatorsHtml}
        </div>
    `;
}


$(document).ready(function() {
    
    setTimeout(loadSupportStudents, 500);
    
    
    setTimeout(loadAdditionalCharts, 800);
    
    
    setTimeout(() => {
        $('.fade-in-up, .fade-in-left, .fade-in-right').addClass('visible');
        $('.float-element').addClass('floating');
    }, 1000);
});
</script>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

{% endblock %}